<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home</title>
  </head>
  <body>
    <nav>
      <span id="fname">Loading...</span>
      <button onclick="logout()">Logout</button>
    </nav>

    <div>
      <h2>Welcome, <span id="username">...</span></h2>
    </div>

    <script>
      var jwt = localStorage.getItem("jwt");

      if (jwt == null) {
        window.location.href = 'login.html';
      }

      function loadUser() {
        const xhttp = new XMLHttpRequest();
        xhttp.open("GET", "http://127.0.0.1:8080/login/user", true);
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.setRequestHeader("Authorization", "Bearer " + jwt);
        xhttp.send();
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4) {
            if (this.status == 200) {
              const response = JSON.parse(this.responseText);
              if (response.status === 'ok') {
                const user = response.user;
                document.getElementById("fname").innerHTML = user.fname;
                document.getElementById("username").innerHTML = user.username;
              }
            } else {
              console.error('Error loading user data', this.responseText);
              if (this.status === 401 || this.status === 403) {
                logout();
              }
            }
          }
        };
      }

      function logout() {
        localStorage.removeItem("jwt");
        window.location.href = "/sec/fronend/login_web/index.html";
      }

      loadUser();
    </script>
  </body>
</html>
